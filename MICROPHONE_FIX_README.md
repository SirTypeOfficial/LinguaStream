# راهنمای حل مشکل دسترسی به میکروفن

## مشکل اصلی
مرورگرها به دلایل امنیتی اجازه دسترسی مستقیم به میکروفن را نمی‌دهند. کد قبلی از `pyaudio` استفاده می‌کرد که فقط در محیط‌های دسکتاپ کار می‌کند.

## راه‌حل پیاده‌سازی شده

### 1. استفاده از Web Audio API
- پیاده‌سازی کلاس `AudioRecorder` در JavaScript
- استفاده از `navigator.mediaDevices.getUserMedia()` برای دسترسی به میکروفن
- ضبط صدا با `MediaRecorder` API

### 2. رابط کاربری بهبود یافته
- دکمه‌های ضبط و توقف با طراحی مدرن
- نمایش سطح صدا در زمان واقعی
- تایمر ضبط
- وضعیت‌های مختلف (آماده، در حال ضبط، پردازش)

### 3. پردازش فایل‌های صوتی
- تبدیل فایل‌های WebM به فرمت مناسب
- استفاده از `pydub` برای پردازش صوتی
- ارسال فایل‌ها به سرور برای تشخیص گفتار

## نحوه استفاده

### 1. نصب وابستگی‌ها
```bash
pip install -r requirements.txt
```

### 2. اجرای برنامه
```bash
streamlit run app.py
```

### 3. مراحل استفاده
1. روی دکمه "🚀 راه‌اندازی سیستم" کلیک کنید
2. روی دکمه "✅ اجازه دسترسی میکروفن" کلیک کنید
3. مرورگر از شما اجازه دسترسی به میکروفن را می‌خواهد - "Allow" را انتخاب کنید
4. روی دکمه "🎤 شروع ضبط" کلیک کنید
5. صحبت کنید
6. روی دکمه "⏹️ توقف ضبط" کلیک کنید
7. منتظر پردازش و نمایش متن تشخیص داده شده باشید

## فایل‌های جدید

### `static/js/audio_recorder.js`
کلاس JavaScript برای مدیریت ضبط صدا در مرورگر

### `static/css/audio_recorder.css`
استایل‌های CSS برای رابط کاربری ضبط صدا

### `api_server.py`
سرور Flask برای پردازش فایل‌های صوتی

### `test_recorder.html`
فایل HTML برای تست مستقل رابط کاربری

## ویژگی‌های جدید

- ✅ دسترسی به میکروفن در مرورگر
- ✅ ضبط صدا با کیفیت بالا
- ✅ نمایش سطح صدا در زمان واقعی
- ✅ تایمر ضبط
- ✅ رابط کاربری مدرن و زیبا
- ✅ پردازش خودکار فایل‌های صوتی
- ✅ تشخیص گفتار فارسی

## عیب‌یابی

### اگر دسترسی میکروفن داده نمی‌شود:
1. مطمئن شوید که از HTTPS استفاده می‌کنید (یا localhost)
2. تنظیمات مرورگر را بررسی کنید
3. میکروفن را در تنظیمات سیستم بررسی کنید

### اگر فایل صوتی پردازش نمی‌شود:
1. مطمئن شوید که API server در حال اجرا است
2. بررسی کنید که پورت 5000 آزاد است
3. لاگ‌های کنسول مرورگر را بررسی کنید

## نکات مهم

- برنامه در پورت 8501 (Streamlit) و 5000 (API) اجرا می‌شود
- فایل‌های صوتی به صورت موقت ذخیره می‌شوند
- از WebM format برای ضبط استفاده می‌شود
- تشخیص گفتار با مدل Whisper انجام می‌شود
